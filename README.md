# AvitoPVZService
## Стэк технологий
- Язык разработки: Java 21
- СУБД: PostgreSQL
- Фреймворк: Spring
- Тестирование: Junit и Testcontainers
- Создание образа: Docker

Исходный код сервиса доступен в каталоге `PVZService/src`.

# Запуск приложения

Для сборки и запуска сервиса необходимо использовать `docker compose` в корневой папке проекта:

```bash
$ docker compose up --build
```

В результате будут запущены два контейнера:
- `postgres-db-pvzservice` - сервис с БД PostgreSQL. Порты - `5432:5432`, если на машине присутствует другая база данных или сервис слушающий порт `5432` то необходимо изменить первый порт;
- `pvz-service-app-pvzservice` - сервис логики магазина мерча. Порты - `8080:8080`.

После поднятия сервис доступен по адресу `http://localhost:8080`. [API](https://github.com/avito-tech/tech-internship/blob/main/Tech%20Internships/Backend/Backend-trainee-assignment-spring-2025/swagger.yaml) реализовано в соответствии с заданием.

# Тестирование

Проект содержит модульные и интеграционные-тесты.  
Исходный код тестов находится в директории `merchshop/src/test/java/com/avito/pvzservice/unit`.  
Тесты можно запустить с помощью команды `mvn test`.  
  
Также для обеспечения надежности и изоляции тестирования использовались testсontainers создающие временный Docker-образ в котором развертывается приложение и проводится его тестирование, что позволяет избежать действий с реальными данными на основной БД.

## Интеграционное тестирование

Описанные тест-кейсы:
- покупка мерча: приобретается 1 предмет, после чего проверяется корректное изменение баланса и запись предмета в инвентарь пользователя;
- передача монеток: от `user1` передаются монеты `user2`, после чего проверяется правильное изменение баланса обоих пользователей;

## Покрытие проекта модульными тестами

При написание модульного тестирования использовались классы-заглушки, помеченные аннотацией `@MockBean`.  
Для отображения процента покрытия теста IntellijIDEA предоставляет функционал запуска с покрытием, для полного описания результата тестирования нужно указать папку `src/test/java/com/avito/pvzservice/unit` как папку запуска.
Тестирование проводилось для классов имплементации сервисов, т.к. в них сосредоточена логика сервиса. 

Покрытие класса модульным тестами следующее:

| Element              | Class, %   | Method, %  | Line, %      | Branch, %    |
|:--------------------:|:----------:|:----------:|:------------:|:------------:|
| ProductServiceImpl   | 100% (1/1) | 100% (2/2) | 100% (24/24) | 100%, (10/10)|
| PVZServiceImpl       | 100% (1/1) | 100% (6/6) | 100% (82/82) | 100%, (30/30)|
| ReceptionServiceImpl | 100% (1/1) | 100% (2/2) | 100% (19/19) | 100%, (6/6)  |
| UserServiceImpl      | 100% (1/1) | 75% (3/4)  | 95% (20/21)  | 100%, (6/6)  |
